import{a as me,s as pe}from"../chunks/94wOsH-7.js";import{H as _e,g as ge}from"../chunks/JhTlYO8B.js";import{f as u,a as o,b as Y,t as X,c as A}from"../chunks/CtvB_Hsv.js";import{p as $,a as ee,c as s,aj as he,r as n,b as E,a9 as xe,Z as we,s as _,t as Z,d as g,n as ye,f as q,g as r,a0 as be}from"../chunks/B2myL-Op.js";import{s as z}from"../chunks/D5IRr4dr.js";import{i as C}from"../chunks/BStlHI7h.js";import{e as ke}from"../chunks/D2IpoJVx.js";import{e as Ce}from"../chunks/9WhkDaYY.js";import{a as Se,s as G}from"../chunks/B3Eyg1U9.js";import{b as Te}from"../chunks/BN94MnuU.js";import{B as J}from"../chunks/CwAKgekT.js";import{I as je}from"../chunks/DFjWJ350.js";import{s as Be,c as Pe}from"../chunks/x3I-lMCg.js";import{r as ze}from"../chunks/BPtYs5MB.js";function De(h,t){throw new _e(h,t)}async function He({params:h}){const t=localStorage.getItem("phoneNumber");if(!t)return{conversation:null,phoneNumber:null};try{return{conversation:await me(h.id,t),phoneNumber:t}}catch(l){throw console.error("Failed to load conversation:",l),De(404,"Conversation not found")}}const nt=Object.freeze(Object.defineProperty({__proto__:null,load:He},Symbol.toStringTag,{value:"Module"}));var Me=u("<div><!></div>");function Ne(h,t){$(t,!0);let l=ze(t,["$$slots","$$events","$$legacy","class","children"]);var v=Me();Se(v,x=>({class:x,...l}),[()=>Pe("relative overflow-auto",t.class)]);var f=s(v);Be(f,()=>t.children??he),n(v),o(h,v),ee()}var Ie=Y('<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m15 18-6-6 6-6"></path></svg>'),Fe=u('<p class="text-xs text-muted-foreground"> </p>'),Le=u('<div class="py-8 text-center text-muted-foreground"><p>Conversation not found.</p> <!></div>'),Oe=u('<div class="py-8 text-center text-muted-foreground"><p>No messages yet. Start the conversation!</p></div>'),Ue=u('<span title="Voice message">ðŸŽ¤</span>'),Ve=u('<span title="Text message">ðŸ’¬</span>'),Ae=u('<div><div><p class="whitespace-pre-wrap"> </p> <div><span> </span> <!></div></div></div>'),Ee=u('<div class="container max-w-2xl space-y-4 px-4 py-4"><!></div>'),Ze=Y('<svg class="h-4 w-4 animate-spin" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>'),qe=u('<div class="border-t p-4"><form class="container flex max-w-2xl gap-2"><!> <!></form></div>'),Ge=u('<div class="flex h-screen flex-col bg-background"><header class="border-b px-4 py-3"><div class="container flex max-w-2xl items-center gap-4"><!> <div><h1 class="font-semibold"> </h1> <!></div></div></header> <!> <!></div>');function it(h,t){$(t,!0);let l=E(xe([])),v=E(""),f=E(!1),x;we(()=>{var e;(e=t.data.conversation)!=null&&e.messages&&_(l,[...t.data.conversation.messages],!0)});function te(e){return new Date(e).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})}function re(){x&&(x.scrollTop=x.scrollHeight)}async function ae(e){if(e.preventDefault(),!r(v).trim()||r(f)||!t.data.conversation)return;const i=r(v).trim();_(v,""),_(f,!0);try{const a=await pe(t.data.conversation.id,i);_(l,[...r(l),a.user_message],!0),a.assistant_message&&_(l,[...r(l),a.assistant_message],!0),setTimeout(re,50)}catch(a){console.error("Failed to send message:",a),_(v,i,!0)}finally{_(f,!1)}}var D=Ge(),H=s(D),K=s(H),Q=s(K);J(Q,{variant:"ghost",size:"icon",onclick:()=>ge("/chats"),children:(e,i)=>{var a=Ie();o(e,a)},$$slots:{default:!0}});var R=g(Q,2),M=s(R),oe=s(M,!0);n(M);var se=g(M,2);{var ne=e=>{var i=Fe(),a=s(i,!0);n(i),Z(y=>z(a,y),[()=>new Date(t.data.conversation.started_at).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric",hour:"numeric",minute:"2-digit"})]),o(e,i)};C(se,e=>{t.data.conversation&&e(ne)})}n(R),n(K),n(H);var W=g(H,2);Te(Ne(W,{class:"flex-1 overflow-y-auto",children:(e,i)=>{var a=Ee(),y=s(a);{var N=m=>{var w=Le(),b=g(s(w),2);J(b,{href:"/chats",class:"mt-4",children:(T,B)=>{ye();var d=X("Back to Chats");o(T,d)},$$slots:{default:!0}}),n(w),o(m,w)},S=m=>{var w=A(),b=q(w);{var T=d=>{var c=Oe();o(d,c)},B=d=>{var c=A(),j=q(c);ke(j,17,()=>r(l),I=>I.id,(I,k)=>{var P=Ae(),F=s(P),L=s(F),ve=s(L,!0);n(L);var O=g(L,2),U=s(O),ce=s(U,!0);n(U);var de=g(U,2);{var ue=p=>{var V=Ue();o(p,V)},fe=p=>{var V=Ve();o(p,V)};C(de,p=>{r(k).source==="voice"?p(ue):p(fe,!1)})}n(O),n(F),n(P),Z(p=>{G(P,1,`flex ${r(k).role==="user"?"justify-end":"justify-start"}`),G(F,1,`max-w-[80%] rounded-lg px-4 py-2 ${r(k).role==="user"?"bg-primary text-primary-foreground":"bg-muted"}`),z(ve,r(k).content),G(O,1,`mt-1 flex items-center gap-1 text-xs ${r(k).role==="user"?"text-primary-foreground/70":"text-muted-foreground"}`),z(ce,p)},[()=>te(r(k).created_at)]),o(I,P)}),o(d,c)};C(b,d=>{r(l).length===0?d(T):d(B,!1)},!0)}o(m,w)};C(y,m=>{t.data.conversation?m(S,!1):m(N)})}n(a),o(e,a)},$$slots:{default:!0}}),e=>x=e,()=>x);var ie=g(W,2);{var le=e=>{var i=qe(),a=s(i),y=s(a);je(y,{placeholder:"Continue the conversation...",get disabled(){return r(f)},class:"flex-1",get value(){return r(v)},set value(S){_(v,S,!0)}});var N=g(y,2);{let S=be(()=>!r(v).trim()||r(f));J(N,{type:"submit",get disabled(){return r(S)},children:(m,w)=>{var b=A(),T=q(b);{var B=c=>{var j=Ze();o(c,j)},d=c=>{var j=X("Send");o(c,j)};C(T,c=>{r(f)?c(B):c(d,!1)})}o(m,b)},$$slots:{default:!0}})}n(a),n(i),Ce("submit",a,ae),o(e,i)};C(ie,e=>{t.data.conversation&&e(le)})}n(D),Z(()=>{var e;return z(oe,((e=t.data.conversation)==null?void 0:e.title)||"Conversation")}),o(h,D),ee()}export{it as component,nt as universal};
