import{g as he,c as re,B as E,e as xe,s as be}from"../chunks/CveQ4vnV.js";import{H as ye,g as we}from"../chunks/l-5YitvB.js";import{f as u,a,b as ae,t as ee,c as q}from"../chunks/3IAQgkcG.js";import{p as R,a as W,c as s,M as ke,r as n,d as G,z as Ce,ay as Se,b as h,t as J,s as x,n as Pe,a1 as K,g as r,a6 as Te}from"../chunks/DaFqHzVn.js";import{s as z}from"../chunks/CiEvsBQu.js";import{i as C}from"../chunks/CdKW0PxI.js";import{e as Be}from"../chunks/DmLb38fm.js";import{a as oe,s as Q}from"../chunks/pYQc-_kp.js";import{b as je}from"../chunks/0uibvxPT.js";import{b as ze}from"../chunks/rmXX7CAT.js";import{p as te,r as se}from"../chunks/BeFkd0eD.js";import{s as Me}from"../chunks/B6hwyZ9q.js";function De(p,e){throw new ye(p,e)}async function He({params:p}){const e=localStorage.getItem("phoneNumber");if(!e)return{conversation:null,phoneNumber:null};try{return{conversation:await he(p.id,e),phoneNumber:e}}catch(i){throw console.error("Failed to load conversation:",i),De(404,"Conversation not found")}}const it=Object.freeze(Object.defineProperty({__proto__:null,load:He},Symbol.toStringTag,{value:"Module"}));var Ne=u("<input/>");function Fe(p,e){R(e,!0);let i=te(e,"value",15,""),l=te(e,"type",3,"text"),f=se(e,["$$slots","$$events","$$legacy","class","value","type"]);var d=Ne();oe(d,M=>({type:l(),class:M,...f}),[()=>re("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",e.class)],void 0,void 0,void 0,!0),ze(d,i),a(p,d),W()}var Ie=u("<div><!></div>");function Le(p,e){R(e,!0);let i=se(e,["$$slots","$$events","$$legacy","class","children"]);var l=Ie();oe(l,d=>({class:d,...i}),[()=>re("relative overflow-auto",e.class)]);var f=s(l);Me(f,()=>e.children??ke),n(l),a(p,l),W()}var Oe=ae('<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m15 18-6-6 6-6"></path></svg>'),Ue=u('<p class="text-xs text-muted-foreground"> </p>'),Ve=u('<div class="py-8 text-center text-muted-foreground"><p>Conversation not found.</p> <!></div>'),Ae=u('<div class="py-8 text-center text-muted-foreground"><p>No messages yet. Start the conversation!</p></div>'),Ee=u('<span title="Voice message">ðŸŽ¤</span>'),qe=u('<span title="Text message">ðŸ’¬</span>'),Ge=u('<div><div><p class="whitespace-pre-wrap"> </p> <div><span> </span> <!></div></div></div>'),Je=u('<div class="container max-w-2xl space-y-4 px-4 py-4"><!></div>'),Ke=ae('<svg class="h-4 w-4 animate-spin" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>'),Qe=u('<div class="border-t p-4"><form class="container flex max-w-2xl gap-2"><!> <!></form></div>'),Re=u('<div class="flex h-screen flex-col bg-background"><header class="border-b px-4 py-3"><div class="container flex max-w-2xl items-center gap-4"><!> <div><h1 class="font-semibold"> </h1> <!></div></div></header> <!> <!></div>');function lt(p,e){R(e,!0);let i=G(Ce([])),l=G(""),f=G(!1),d;Se(()=>{var t;(t=e.data.conversation)!=null&&t.messages&&h(i,[...e.data.conversation.messages],!0)});function M(t){return new Date(t).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})}function ne(){d&&(d.scrollTop=d.scrollHeight)}async function ie(t){if(t.preventDefault(),!r(l).trim()||r(f)||!e.data.conversation)return;const v=r(l).trim();h(l,""),h(f,!0);try{const o=await be(e.data.conversation.id,v);h(i,[...r(i),o.user_message],!0),o.assistant_message&&h(i,[...r(i),o.assistant_message],!0),setTimeout(ne,50)}catch(o){console.error("Failed to send message:",o),h(l,v,!0)}finally{h(f,!1)}}var D=Re(),H=s(D),X=s(H),Y=s(X);E(Y,{variant:"ghost",size:"icon",onclick:()=>we("/chats"),children:(t,v)=>{var o=Oe();a(t,o)},$$slots:{default:!0}});var Z=x(Y,2),N=s(Z),le=s(N,!0);n(N);var ve=x(N,2);{var de=t=>{var v=Ue(),o=s(v,!0);n(v),J(y=>z(o,y),[()=>new Date(e.data.conversation.started_at).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric",hour:"numeric",minute:"2-digit"})]),a(t,v)};C(ve,t=>{e.data.conversation&&t(de)})}n(Z),n(X),n(H);var $=x(H,2);je(Le($,{class:"flex-1 overflow-y-auto",children:(t,v)=>{var o=Je(),y=s(o);{var F=g=>{var b=Ve(),w=x(s(b),2);E(w,{href:"/chats",class:"mt-4",children:(P,B)=>{Pe();var m=ee("Back to Chats");a(P,m)},$$slots:{default:!0}}),n(b),a(g,b)},S=g=>{var b=q(),w=K(b);{var P=m=>{var c=Ae();a(m,c)},B=m=>{var c=q(),T=K(c);xe(T,17,()=>r(i),I=>I.id,(I,k)=>{var j=Ge(),L=s(j),O=s(L),fe=s(O,!0);n(O);var U=x(O,2),V=s(U),me=s(V,!0);n(V);var pe=x(V,2);{var ge=_=>{var A=Ee();a(_,A)},_e=_=>{var A=qe();a(_,A)};C(pe,_=>{r(k).source==="voice"?_(ge):_(_e,!1)})}n(U),n(L),n(j),J(_=>{Q(j,1,`flex ${r(k).role==="user"?"justify-end":"justify-start"}`),Q(L,1,`max-w-[80%] rounded-lg px-4 py-2 ${r(k).role==="user"?"bg-primary text-primary-foreground":"bg-muted"}`),z(fe,r(k).content),Q(U,1,`mt-1 flex items-center gap-1 text-xs ${r(k).role==="user"?"text-primary-foreground/70":"text-muted-foreground"}`),z(me,_)},[()=>M(r(k).created_at)]),a(I,j)}),a(m,c)};C(w,m=>{r(i).length===0?m(P):m(B,!1)},!0)}a(g,b)};C(y,g=>{e.data.conversation?g(S,!1):g(F)})}n(o),a(t,o)},$$slots:{default:!0}}),t=>d=t,()=>d);var ce=x($,2);{var ue=t=>{var v=Qe(),o=s(v),y=s(o);Fe(y,{placeholder:"Continue the conversation...",get disabled(){return r(f)},class:"flex-1",get value(){return r(l)},set value(S){h(l,S,!0)}});var F=x(y,2);{let S=Te(()=>!r(l).trim()||r(f));E(F,{type:"submit",get disabled(){return r(S)},children:(g,b)=>{var w=q(),P=K(w);{var B=c=>{var T=Ke();a(c,T)},m=c=>{var T=ee("Send");a(c,T)};C(P,c=>{r(f)?c(B):c(m,!1)})}a(g,w)},$$slots:{default:!0}})}n(o),n(v),Be("submit",o,ie),a(t,v)};C(ce,t=>{e.data.conversation&&t(ue)})}n(D),J(()=>{var t;return z(le,((t=e.data.conversation)==null?void 0:t.title)||"Conversation")}),a(p,D),W()}export{lt as component,it as universal};
